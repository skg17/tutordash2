<%# Helper methods for cleaner display %>
<%
  # --- 1. Determine Lesson Status ---
  # Assuming lesson.date is a DateTime or Time object
  if @lesson.date && @lesson.date > Time.current
    status_text = 'Upcoming'
    status_class = 'text-green-700 bg-green-100' # Green for Upcoming
  else
    status_text = 'Completed'
    status_class = 'text-gray-700 bg-gray-100' # Gray for Completed
  end
  
  # --- 2. Format Time & Duration ---
  start_time = @lesson.date&.strftime("%I:%M %p")
  end_time = (@lesson.date + (@lesson.duration || 1).hours)&.strftime("%I:%M %p") rescue "N/A" # Calculate end time
  duration_text = "#{@lesson.duration} hours" # Assuming duration is stored in hours
%>

<section class="flex flex-col md:flex-row justify-between md:items-center mb-8 space-y-4 md:space-y-0">

    <%# LEFT SIDE: BACK LINK, TITLE, SUBTITLE %>
    <div class="flex flex-col">
        
        <%= link_to lessons_path, class: "flex items-center text-lg font-semibold text-gray-700 hover:text-purple-600 transition duration-150 mb-1" do %>
            <div class="icon mr-2" data-lucide="arrow-left" style="width: 20px; height: 20px;"></div>
            <span class="text-sm uppercase tracking-wider">Back to Lessons</span>
        <% end %>

        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900">Lesson Details</h1>
        <p class="text-gray-500">View and edit the lesson details.</p>
        
    </div>

    <%# RIGHT SIDE: ACTION BUTTONS - Stacks vertically on mobile (flex-col) %>
    <%# FIX: Added sm:space-x-reverse to correctly apply horizontal spacing with flex-row-reverse %>
    <div class="flex flex-col sm:flex-row-reverse w-full sm:w-auto sm:justify-end space-y-2 sm:space-y-0 sm:space-x-4 sm:space-x-reverse">
        
        <%# Join Button (Primary Action) %>
        <%= link_to "https://meet.google.com", 
            class: "flex items-center justify-center w-full sm:w-auto px-6 py-2 text-sm font-semibold rounded-xl bg-purple-600 text-white shadow-lg hover:bg-purple-700 transition duration-150" do %>
            <div class="icon mr-2" data-lucide="video" style="width: 16px; height: 16px;"></div>
            Join
        <% end %>

        <%# Edit Button %>
        <%= link_to edit_lesson_path(@lesson), 
            class: "flex items-center justify-center w-full sm:w-auto px-4 py-2 text-sm font-semibold rounded-xl text-gray-700 border border-gray-300 hover:bg-gray-100 transition duration-150" do %>
            <div class="icon mr-2" data-lucide="edit" style="width: 16px; height: 16px;"></div>
            Edit
        <% end %>
        
        <%# Delete Button (Uses form:w-full for consistency with Edit/Join links) %>
        <%= button_to @lesson, method: :delete, data: { turbo_confirm: "Are are sure you want to permanently delete this lesson?"}, 
             form_class: "inline-block w-full sm:w-auto", # Ensure the form takes full width on mobile
             class: "flex items-center justify-center w-full px-4 py-2 text-sm font-semibold rounded-xl bg-red-500 text-white shadow-md hover:bg-red-600 transition duration-150" do %>
            <div class="icon mr-2" data-lucide="trash-2" style="width: 16px; height: 16px;"></div>
            Delete
        <% end %>
        
    </div>
</section>

<div class="space-y-8">
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <div class="card-shadow bg-white p-8 rounded-3xl border border-gray-100 space-y-6">
            
            <div class="flex items-start pb-4 border-b border-gray-100">
                <div class="icon mr-4 mt-1 text-purple-600" data-lucide="book-open-text" style="width: 24px; height: 24px;"></div>
                
                <div class="flex flex-col">
                    <div class="flex items-center space-x-3">
                        <h2 class="text-2xl font-bold text-gray-900"><%= @lesson.subject %></h2>
                        <span class="text-sm font-medium px-3 py-1 rounded-full <%= status_class %>"><%= status_text %></span>
                    </div>
                </div>
            </div>

            <div class="space-y-4 text-gray-700">
                
                <%# Student %>
                <div class="flex items-center space-x-4">
                    <div class="icon text-gray-500" data-lucide="user" style="width: 18px; height: 18px;"></div>
                    <div>
                        <p class="text-sm">Student</p>
                        <p class="font-semibold"><%= @lesson.student&.name %></p>
                    </div>
                </div>

                <%# Date %>
                <div class="flex items-center space-x-4">
                    <div class="icon text-gray-500" data-lucide="calendar" style="width: 18px; height: 18px;"></div>
                    <div>
                        <p class="text-sm">Date</p>
                        <p class="font-semibold"><%= @lesson.date&.strftime("%A, %B %-d, %Y") %></p>
                    </div>
                </div>

                <%# Time & Duration %>
                <div class="flex items-center space-x-4">
                    <div class="icon text-gray-500" data-lucide="clock" style="width: 18px; height: 18px;"></div>
                    <div>
                        <p class="text-sm">Time</p>
                        <p class="font-semibold"><%= start_time %> - <%= end_time %></p>
                    </div>
                </div>
                
            </div>
        </div>

        <div class="card-shadow bg-white p-8 rounded-3xl border border-gray-100">
            <div class="flex items-start pb-4 border-b border-gray-100">
                <div class="icon mr-4 mt-1 text-teal-500" data-lucide="dollar-sign" style="width: 24px; height: 24px;"></div>
                <h2 class="text-xl font-bold text-gray-900">Payment & Earnings</h2>
            </div>
            
            <div class="space-y-6 pt-4">
                <%# Payment Status %>
                <div class="flex items-center space-x-3">
                    <div class="icon text-green-500" data-lucide="check-circle" style="width: 20px; height: 20px;"></div>
                    <div>
                        <p class="text-sm text-gray-500">Payment Status</p>
                        <p class="font-semibold text-green-600"><%= @lesson.paid? ? 'Paid' : 'Pending' %></p>
                    </div>
                </div>
                
                <%# Amount Earned (Calculated field) %>
                <% 
                  # Calculate amount. Assuming student.rate is available.
                  rate = @lesson.student&.rate
                  amount_earned = @lesson.duration * rate
                %>
                <div>
                    <p class="text-sm text-gray-500">Amount Earned</p>
                    <p class="text-3xl font-bold text-purple-600 mt-1">Â£<%= '%.2f' % amount_earned %></p>
                </div>
            </div>
        </div>
    </div>

    <div class="card-shadow bg-white p-8 rounded-3xl border border-gray-100">
        <div class="flex items-start pb-4 border-b border-gray-100">
            <div class="icon mr-4 mt-1 text-purple-600" data-lucide="notebook-text" style="width: 24px; height: 24px;"></div>
            <h2 class="text-xl font-bold text-gray-900">Homework and Notes</h2>
        </div>
        <p class="text-gray-700 pt-4"><%= @lesson.homework.present? ? @lesson.homework : "No homework or session notes recorded." %></p>
    </div>
</div>