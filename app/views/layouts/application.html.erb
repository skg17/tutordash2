<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "TutorDash" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <!-- M3 Expressive Theme Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <!-- Custom CSS for Sidebar and M3 Effects (Move this to application.css if preferred) -->
    <style>
        :root {
            --sidebar-bg: #2C2A4A;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
            overflow-x: hidden;
        }

        /* Sidebar styles */
        .sidebar {
            background-color: var(--sidebar-bg);
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.3);
        }
        
        /* Utility for Lucide icon replacement */
        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    </style>
  </head>

  <body>
    <!-- Main Wrapper: Flex container for Sidebar and Main Content -->
    <div class="flex min-h-screen">
        
        <!-- 1. SIDEBAR (The Navigation Menu) -->
        <%= render 'shared/sidebar' %>

        <!-- 2. Mobile Overlay/Backdrop (Click to close menu) -->
        <div id="sidebar-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden" onclick="window.toggleSidebar()"></div>

        <!-- 3. Mobile Menu Button -->
        <button id="menu-button" class="md:hidden fixed top-4 left-4 z-50 p-2 rounded-full bg-purple-600 text-white shadow-lg">
            <div class="icon" data-lucide="menu" style="width: 24px; height: 24px;"></div>
        </button>

        <!-- 4. Main Content Area -->
        <main class="flex-1 p-4 md:p-8 md:ml-64">
            <%= yield %>
        </main>
    </div>

    <!-- JavaScript for Mobile Sidebar Toggle and Icons (Place at end of body) -->
    <script>
        document.addEventListener('turbo:load', () => { // Use turbo:load for Turbo/Hotwire compatibility
            const sidebar = document.getElementById('sidebar');
            const menuButton = document.getElementById('menu-button');
            const backdrop = document.getElementById('sidebar-backdrop');
            
            // Function to toggle sidebar visibility on mobile
            window.toggleSidebar = function() {
                sidebar.classList.toggle('-translate-x-full');
                backdrop.classList.toggle('hidden');
            }

            // Event listener for the menu button
            menuButton.addEventListener('click', window.toggleSidebar);
            
            // Re-render Lucide icons after DOM is loaded/Turbo navigation
            lucide.createIcons();
        });
    </script>
  </body>
</html>
